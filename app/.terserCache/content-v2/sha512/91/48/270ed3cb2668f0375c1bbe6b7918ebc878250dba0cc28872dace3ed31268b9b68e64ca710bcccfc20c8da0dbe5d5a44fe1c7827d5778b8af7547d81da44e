{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{250:function(e,t,n){e.exports={toolsBox:\"_2OOgf\",tableBox:\"_3locr\",fl:\"_2If2e\",fr:\"_2v1iu\",mr10:\"_R-c_O\",ml10:\"_k05_a\",affix:\"_2kc2R\"}},255:function(e,t,n){\"use strict\";var a=n(233),i=n(0),s=n.n(i),o=n(1),r=n.n(o);t.a=function(e){return function(t){var n,o;return o=n=class extends i.Component{constructor(){var t;super(...arguments);const n=(null==this?void 0:null===(t=this.props)||void 0===t?void 0:t.injectReducers)||null;n&&n(e)}render(){return s.a.createElement(t,null)}},Object(a.a)(n,\"propTypes\",{injectReducers:r.a.func}),o}}},265:function(e,t,n){\"use strict\";(function(e){n.d(t,\"b\",function(){return o}),n.d(t,\"a\",function(){return r}),n.d(t,\"d\",function(){return c}),n.d(t,\"c\",function(){return l}),n.d(t,\"e\",function(){return d});const a=e.require(\"request\"),i={method:\"POST\",json:!0};function s(e){return{\"Content-Type\":\"application/json;charset=utf-8\",appInfo:JSON.stringify({vendor:\"apple\",deviceId:`${Math.floor(1e10*Math.random())}`,appVersion:\"6.0.0\",appBuild:\"190409\",osVersion:\"11.4.1\",osType:\"ios\",deviceName:\"iPhone 6s\",os:\"ios\"}),token:e}}function o(e,t){return new Promise((n,o)=>{a({...i,headers:s(),uri:\"https://pocketapi.48.cn/user/api/v1/login/app/mobile\",body:{mobile:e,pwd:t},gzip:!0,timeout:6e4},(e,t,a)=>{e?o(e):n(a)})}).catch(e=>{console.error(e)})}function r(e){return new Promise((t,n)=>{a({...i,headers:s(e),uri:\"https://pocketapi.48.cn/user/api/v1/friendships/friends/id\",body:{},gzip:!0,timeout:15e3},(e,a,i)=>{e?n(e):t(i)})}).catch(e=>{console.error(e)})}function c(e,t){return new Promise((n,i)=>{a({uri:\"https://pocketapi.48.cn/im/api/v1/chatroom/msg/list/homeowner\",method:\"POST\",headers:s(t),json:!0,body:{needTop1Msg:!1,roomId:e,nextTime:0},gzip:!0,timeout:15e3},(e,t,a)=>{e?i(e):n(a)})}).catch(e=>{console.error(e)})}function l(e,t,n){return new Promise((i,o)=>{a({uri:\"https://pocketapi.48.cn/idolanswer/api/idolanswer/v1/question_answer/detail\",method:\"POST\",headers:s(e),json:!0,body:{questionId:t,answerId:n},gzip:!0,timeout:15e3},(e,t,n)=>{e?o(e):i(n)})}).catch(e=>{console.error(e)})}function d(e){return new Promise((t,n)=>{a({uri:\"https://pocketapi.48.cn/im/api/v1/conversation/page\",method:\"POST\",headers:s(e),json:!0,body:{targetType:0},gzip:!0,timeout:6e4},(e,a,i)=>{e?n(e):t(i)})}).catch(e=>{console.error(e)})}}).call(this,n(26))},271:function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return l}),n.d(t,\"b\",function(){return m}),n.d(t,\"d\",function(){return u}),n.d(t,\"e\",function(){return h});var a=n(469),i=n(466),s=n(39),o=n(87),r=n(134);const c={qqLoginList:Object(s.List)([]),optionList:Object(s.List)([]),kd48LiveListenerTimer:null},l=Object(a.a)(\"获取已登录的列表\"),d=Object(a.a)(\"配置列表\"),m=r.a.cursorAction({objectStoreName:o.a.indexeddb.objectStore[0].name,successAction:d}),u=r.a.getAction({objectStoreName:o.a.indexeddb.objectStore[2].name}),h=Object(a.a)(\"口袋直播监听\"),p=Object(i.a)({[l]:(e,t)=>e.set(\"qqLoginList\",Object(s.List)(t.payload.qqLoginList)),[d]:(e,t)=>{const n=\"optionList\"in t.payload?t.payload.optionList:t.payload.result;return e.set(\"optionList\",Object(s.List)(n))},[h]:(e,t)=>e.set(\"kd48LiveListenerTimer\",t.payload.timer)},Object(s.fromJS)(c));t.c={login:p}},284:function(e,t,n){\"use strict\";(function(e){n.d(t,\"b\",function(){return i}),n.d(t,\"c\",function(){return s}),n.d(t,\"a\",function(){return o}),n.d(t,\"d\",function(){return r}),n.d(t,\"e\",function(){return c});const a=e.require(\"mysql\");function i(e,t){const n=a.createConnection({host:e.hostname,port:e.port,user:e.user,password:e.password,database:e.database});return n.connect(),new Promise((a,i)=>{n.query(`SELECT id, userid, nickname, record from ${e.table} WHERE userid=?`,[t],(e,t,s)=>{e?i(e):a(t),n.end()})})}function s(e,t){const n=a.createConnection({host:e.hostname,port:e.port,user:e.user,password:e.password,database:e.database});return n.connect(),new Promise((a,i)=>{n.query(`SELECT id, userid, nickname, record from ${e.table} WHERE userid=? OR nickname=?`,[t,t],(e,t,s)=>{e?i(e):a(t),n.end()})})}function o(e,t,n,i){const s=a.createConnection({host:e.hostname,port:e.port,user:e.user,password:e.password,database:e.database});return s.connect(),new Promise((a,o)=>{s.query(`INSERT INTO ${e.table} (userid, nickname, record) VALUES (?, ?, ?)`,[t,n,JSON.stringify(i)],(e,t,n)=>{e?o(e):a(t),s.end()})})}function r(e,t,n,i){const s=a.createConnection({host:e.hostname,port:e.port,user:e.user,password:e.password,database:e.database});return s.connect(),new Promise((a,o)=>{s.query(`UPDATE ${e.table} SET nickname=?, record=? WHERE userid=?`,[n,JSON.stringify(i),t],(e,t,n)=>{e?o(e):a(t),s.end()})})}function c(e,t,n){const i=a.createConnection({host:e.hostname,port:e.port,user:e.user,password:e.password,database:e.database});return i.connect(),new Promise((a,s)=>{i.query(`UPDATE ${e.table} SET record=? WHERE userid=?`,[JSON.stringify(n),t],(e,t,n)=>{e?s(e):a(t),i.end()})})}}).call(this,n(26))},312:function(e,t,n){e.exports={body:\"_3sDhV\",o:\"_AEzmp\",zhuyi:\"_1wfzM\",noOption:\"_2Qx3b\",changeOption:\"_76pQs\",select:\"_2NclR\",detail:\"_2Z0ol\",tdGTitle:\"_3n8Ks\",tdTitle:\"_3iG1M\",on:\"_3sp_b\",off:\"_2crnb\",td1:\"_1qXBL\",td2:\"_1Z-mL\"}},313:function(e,t,n){\"use strict\";function a(e){return Math.floor(Math.random()*e)}function i(e){const t=[];for(let i=0,s=e.length;i<s;i++){const{level:n=\"\",length:s=0,data:o}=e[i],r=o.length;if(!(o&&Array.isArray(o)&&o.length>0))break;for(let e=0;e<s;e++)t.push({...o[a(r)],level:n,levelNum:i})}const n=[];for(;t.length>0;){const e=a(t.length);n.push(t[e]),t.splice(e,1)}return n}function s(e,t,n,s=0,o=null){const r=!(null==o),c=r?o:Math.floor(n/t);let l=0;!r&&s>0&&c>=s&&(l=Math.floor(c/s));const d=c+l,m={};for(let u=0;u<d;u++){const t=i(e),n={...t[a(t.length)]};n.id in m?m[n.id].length+=1:(n.length=1,m[n.id]=n)}return m}n.d(t,\"a\",function(){return s})},314:function(e,t,n){\"use strict\";var a=n(232),i=n.n(a),s=n(433);t.a=function(e){const t=Object(s.a)(`pro_id=${e}`);return new Promise((e,n)=>{i.a.ajax({type:\"POST\",url:\"https://wds.modian.com/api/project/detail\",cache:!0,data:t,dataType:\"json\",success(t,n,a){const i=t.data[0];e({title:i.pro_name,already_raised:i.already_raised,goal:i.goal,backer_count:i.backer_count,end_time:i.end_time})},error(e){n(e)}})}).catch(e=>{console.error(e)})}},315:function(e,t,n){\"use strict\";(function(e){n.d(t,\"b\",function(){return s});const a=e.require(\"request\");function i(){return{\"Content-Type\":\"application/json;charset=utf-8\",appInfo:JSON.stringify({vendor:\"apple\",deviceId:`${Math.floor(1e10*Math.random())}`,appVersion:\"6.0.0\",appBuild:\"190409\",osVersion:\"11.4.1\",osType:\"ios\",deviceName:\"iPhone 6s\",os:\"ios\"})}}function s(e){return new Promise((t,n)=>{a({uri:\"https://pocketapi.48.cn/live/api/v1/live/getLiveOne\",method:\"POST\",headers:i(),json:!0,body:{liveId:e}},function(e,a,i){e?n(e):t(i)})})}t.a=function(e=0,t=!1){return new Promise((n,s)=>{const o={debug:!0,next:e};t&&(o.groupId=0,o.record=!1),a({uri:\"https://pocketapi.48.cn/live/api/v1/live/getLiveList\",method:\"POST\",headers:i(),json:!0,body:o},function(e,t,a){e?s(e):n(a)})})}}).call(this,n(26))},319:function(e,t,n){\"use strict\";(function(e){n(268);var a,i,s,o=n(266),r=(n(258),n(269)),c=(n(270),n(259)),l=(n(238),n(236)),d=n(233),m=n(0),u=n.n(m),h=n(1),p=n.n(h),b=n(32),g=n(84),f=n(7),E=n(249),L=n(3),k=n.n(L),v=n(250),q=n.n(v),T=n(271);const S=e=>e.has(\"login\")?e.get(\"login\"):null,w=Object(E.b)({qqLoginList:Object(E.a)(S,e=>null!==e?e.get(\"qqLoginList\").toJS():[]),kd48LiveListenerTimer:Object(E.a)(S,e=>null!==e?e.get(\"kd48LiveListenerTimer\"):null)});let y=Object(g.b)(w,e=>({action:Object(b.b)({changeQQLoginList:T.a,kd48LiveListenerTimer:T.e},e)}))((s=i=class extends m.Component{columus(){return[{title:\"配置名称\",key:\"optionName\",width:\"25%\",render:(e,t)=>t.option.name},{title:\"QQ号\",key:\"qqNumber\",width:\"25%\",render:(e,t)=>t.qq},{title:\"监听群号\",key:\"groupNumber\",width:\"25%\",render:(e,t)=>t.option.groupNumber},{title:\"操作\",key:\"handle\",width:\"25%\",render:(e,t)=>u.a.createElement(c.a,{title:\"确认要退出吗？\",onConfirm:this.handleLogOutClick.bind(this,t)},u.a.createElement(l.a,{type:\"danger\",size:\"small\",icon:\"logout\"},\"退出\"))}]}handleLogOutClick(t,n){const a=this.props.qqLoginList.indexOf(t);if(t.outAndClear(),this.props.qqLoginList.splice(a,1),this.props.action.changeQQLoginList({qqLoginList:this.props.qqLoginList.slice()}),null!==this.props.kd48LiveListenerTimer){let t=!1;for(let e=0,n=this.props.qqLoginList.length;e<n;e++){const n=this.props.qqLoginList[e];if(n.option.basic.is48LiveListener&&n.members){t=!0;break}}!1===t&&(e.clearInterval(this.props.kd48LiveListenerTimer),this.props.action.kd48LiveListenerTimer({timer:null}))}}render(){return[u.a.createElement(r.a,{key:\"affix\",className:q.a.affix},u.a.createElement(\"div\",{className:k()(q.a.toolsBox,\"clearfix\")},u.a.createElement(\"div\",{className:q.a.fl},u.a.createElement(f.b,{className:q.a.mr10,to:\"/Login/Login\"},u.a.createElement(l.a,{type:\"primary\",icon:\"windows-o\"},\"登录\"))),u.a.createElement(\"div\",{className:q.a.fr},u.a.createElement(f.b,{className:q.a.ml10,to:\"/\"},u.a.createElement(l.a,{type:\"danger\",icon:\"poweroff\"},\"返回\"))))),u.a.createElement(\"div\",{key:\"tableBox\",className:q.a.tableBox},u.a.createElement(o.a,{bordered:!0,columns:this.columus(),rowKey:e=>e.time,dataSource:this.props.qqLoginList,pagination:{pageSize:20,showQuickJumper:!0}}))]}},Object(d.a)(i,\"propTypes\",{qqLoginList:p.a.array,kd48LiveListenerTimer:p.a.number,action:p.a.objectOf(p.a.func)}),a=s))||a;t.a=y}).call(this,n(26))},430:function(e,t,n){\"use strict\";(function(e){n(238);var a,i,s,o,r=n(236),c=(n(252),n(253)),l=(n(294),n(288)),d=n(233),m=n(0),u=n.n(m),h=n(1),p=n.n(h),b=n(32),g=n(84),f=n(30),E=n(7),L=n(249),k=n(77),v=n.n(k),q=n(312),T=n.n(q),S=n(250),w=n.n(S),y=n(432),N=n(271),O=n(463),I=n(435),$=n(314),M=n(47),j=n(436),_=n(438),C=n.n(_),x=n(439),P=n.n(x),Q=n(265);const W=e.require(\"node-schedule\"),A=e=>e.has(\"login\")?e.get(\"login\"):null,J=Object(L.b)({qqLoginList:Object(L.a)(A,e=>null!==e?e.get(\"qqLoginList\").toJS():[]),optionList:Object(L.a)(A,e=>null!==e?e.get(\"optionList\").toJS():[]),kd48LiveListenerTimer:Object(L.a)(A,e=>null!==e?e.get(\"kd48LiveListenerTimer\"):null)});let R=(a=Object(g.b)(J,e=>({action:Object(b.b)({changeQQLoginList:N.a,cursorOption:N.b,kd48LiveListenerTimer:N.e,getLoginInformation:N.d},e)})),Object(f.e)(i=a((o=s=class extends m.Component{constructor(){super(...arguments),this.qq=null,this.timer=null,this.state={btnLoading:!1,optionItemIndex:null}}componentDidMount(){this.props.action.cursorOption({query:{indexName:\"time\"}})}selectOptionView(){return this.props.optionList.map((e,t)=>{const n=`${t}`;return u.a.createElement(l.a.Option,{key:n,value:n},e.name)})}handleOptionSelect(e,t){this.setState({optionItemIndex:e})}async loginSuccess(){try{const n=this.qq.option.basic;if(this.qq.time=v()().unix(),this.qq.getCoolQVersionInfo(),n.isModian){const{title:e,goal:t}=await Object($.a)(n.modianId);this.qq.modianTitle=e,this.qq.modianGoal=t,this.qq.modianWorker=new C.a,this.qq.modianWorker.postMessage({type:\"init\",modianId:n.modianId,title:e,goal:t}),this.qq.modianWorker.addEventListener(\"message\",this.qq.listenModianWorkerCbInformation.bind(this.qq),!1),c.a.success(\"摩点监听已就绪。\")}if(n.isChouka&&(Object(M.a)(n.choukaJson),this.qq.choukaJson=e.require(n.choukaJson),this.qq.bukaQQNumber=Object(M.c)(n.bukaQQNumber),c.a.success(\"抽卡已就绪。\")),n.is48LiveListener&&(this.qq.members=Object(M.d)(n.kd48LiveListenerMembers),this.qq.memberId=Object(M.c)(n.kd48LiveListenerMembers),await Object(j.b)(),null===this.props.kd48LiveListenerTimer&&this.props.action.kd48LiveListenerTimer({timer:e.setInterval(j.a,15e3)}),c.a.success(\"口袋48直播监听已就绪。\")),n.isRoomListener){const t=await this.props.action.getLoginInformation({query:\"loginInformation\"});if(void 0!==t.result){this.qq.kouDai48Token=t.result.value.token;const a=await Object(Q.d)(n.roomId,this.qq.kouDai48Token);console.log(\"request: room listen\",a),this.qq.roomLastTime=a.content.message[0].msgTime,this.qq.roomListenerTimer=e.setTimeout(this.qq.listenRoomMessage.bind(this.qq),n.liveListeningInterval?1e3*n.liveListeningInterval:15e3)}c.a.success(\"口袋48房间监听已就绪。\")}n.isWeiboListener&&(this.qq.weiboWorker=new P.a,this.qq.weiboWorker.postMessage({type:\"init\",containerid:n.lfid}),this.qq.weiboWorker.addEventListener(\"message\",this.qq.listenWeiboWorkerCbInformation.bind(this.qq),!1),c.a.success(\"微博监听已就绪。\")),n.isTimingMessagePush&&(this.qq.timingMessagePushTimer=W.scheduleJob(n.timingMessagePushFormat,this.qq.timingMessagePush.bind(this.qq,n.timingMessagePushText)),c.a.success(\"群内定时消息推送已就绪。\"));const a=this.props.qqLoginList;a.push(this.qq),this.props.action.changeQQLoginList({qqLoginList:a}),this.qq=null,this.props.history.push(\"/Login\")}catch(t){console.error(t)}}loginCb(){!0===this.qq.isEventSuccess&&!0===this.qq.isApiSuccess?this.loginSuccess():!0===this.qq.isError?(this.qq=null,this.setState({btnLoading:!1})):this.timer=setTimeout(this.loginCb.bind(this),100)}handleLoginClick(e){this.setState({btnLoading:!0});const t=this.props.optionList[Number(this.state.optionItemIndex)];this.qq=new y.a(t.qqNumber,t.socketPort,O.a),this.qq.option=t,this.qq.init(),this.loginCb()}componentWillUnmount(){if(this.timer&&e.clearInterval(this.timer),null!==this.qq){if(this.qq.outAndClear(),null!==this.props.kd48LiveListenerTimer){let t=!1;for(let e=0,n=this.props.qqLoginList.length;e<n;e++){const n=this.props.qqLoginList[e];if(n.option.basic.is48LiveListener&&n.members){t=!0;break}}!1===t&&(e.clearInterval(this.props.kd48LiveListenerTimer),this.props.action.kd48LiveListenerTimer({timer:null}))}this.qq=null}}render(){const e=this.state.optionItemIndex?Number(this.state.optionItemIndex):null;return u.a.createElement(\"div\",{className:T.a.body},u.a.createElement(\"div\",{className:T.a.changeOption},u.a.createElement(\"p\",{className:T.a.zhuyi},\"注意：要先登录酷Q！\"),u.a.createElement(\"label\",null,\"选择一个配置文件：\"),u.a.createElement(l.a,{className:T.a.select,dropdownClassName:T.a.select,value:this.state.optionItemIndex,onSelect:this.handleOptionSelect.bind(this)},this.selectOptionView()),u.a.createElement(E.b,{className:w.a.ml10,to:\"/Login\"},u.a.createElement(r.a,{type:\"danger\"},\"返回\")),u.a.createElement(r.a,{className:w.a.ml10,type:\"primary\",loading:this.state.btnLoading,disabled:!this.state.optionItemIndex,onClick:this.handleLoginClick.bind(this)},\"连接\")),u.a.createElement(I.a,{detail:null===e?null:this.props.optionList[e]}))}},Object(d.a)(s,\"propTypes\",{qqLoginList:p.a.array,optionList:p.a.array,kd48LiveListenerTimer:p.a.number,action:p.a.objectOf(p.a.func),history:p.a.object,location:p.a.object,match:p.a.object}),i=o))||i)||i);t.a=R}).call(this,n(26))},432:function(e,t,n){\"use strict\";(function(e){n(252);var a=n(253),i=n(265),s=n(47),o=n(313),r=n(284);t.a=class{constructor(e,t,n){this.time=null,this.qq=e,this.port=t,this.isError=!1,this.eventUrl=`ws://127.0.0.1:${this.port}/event/`,this.eventSocket=null,this.isEventSuccess=!1,this.apiUrl=`ws://127.0.0.1:${this.port}/api/`,this.apiSocket=null,this.isApiSuccess=!1,this.callback=n,this.coolqEdition=\"air\",this.option=null,this.modianTitle=null,this.modianGoal=null,this.modianWorker=null,this.choukaJson=null,this.bukaQQNumber=null,this.members=null,this.memberId=null,this.roomListenerTimer=null,this.roomLastTime=null,this.kouDai48Token=null,this.weiboWorker=null,this.timingMessagePushTimer=null,this.handleOpenEventSocket=this._handleOpenSocket.bind(this,\"isEventSuccess\",\"event\"),this.handleEventSocketError=this._handleSocketError.bind(this,\"event\"),this.handleListenerEventMessage=this._handleListenerMessage.bind(this,\"event\"),this.handleOpenApiSocket=this._handleOpenSocket.bind(this,\"isApiSuccess\",\"api\"),this.handleApiSocketError=this._handleSocketError.bind(this,\"api\"),this.handleListenerApiMessage=this._handleListenerMessage.bind(this,\"api\")}_handleOpenSocket(e,t,n){this[e]=!0,a.a.success(`【${this.qq}】 Socket: ${t}连接成功！`)}_handleSocketError(e,t){this.isError=!0,a.a.error(`【${this.qq}】 Socket: ${e}连接失败！请检查酷Q的配置是否正确！`)}_handleListenerMessage(e,t){const n=JSON.parse(`${t.data}`),a=this.option?Number(this.option.groupNumber):0;if(console.log(n),\"event\"===e&&\"group_id\"in n&&n.group_id===a&&n.self_id===Number(this.qq)&&(\"group\"===n.message_type&&this.callback&&this.callback(n,this),\"notice\"!==n.post_type&&\"event\"!==n.post_type||\"group_increase\"!==n.notice_type&&\"group_increase\"!==n.event||!this.option||!this.option.basic.isNewGroupMember||this.getGroupMemberInfo(n)),\"data\"in n&&\"nickname\"in n.data&&\"group_id\"in n.data&&n.data.group_id===a){const{nickname:e,user_id:t}=n.data;this.sendMessage(Object(s.e)(this.option?this.option.basic.welcomeNewGroupMember:\"\",{nickname:e,userid:t}))}\"data\"in n&&\"coolq_edition\"in n.data&&(this.coolqEdition=n.data.coolq_edition)}sendMessage(e){this.apiSocket&&this.apiSocket.send(JSON.stringify({action:\"send_group_msg\",params:{group_id:this.option?Number(this.option.groupNumber):0,message:e}}))}getGroupMemberInfo(e){const t=e.user_id;this.apiSocket&&this.apiSocket.send(JSON.stringify({action:\"get_group_member_info\",params:{group_id:this.option?Number(this.option.groupNumber):0,user_id:t,type:\"group_member_info\"}}))}getCoolQVersionInfo(){this.apiSocket&&this.apiSocket.send(JSON.stringify({action:\"get_version_info\"}))}init(){this.eventSocket=new WebSocket(this.eventUrl),this.eventSocket.addEventListener(\"open\",this.handleOpenEventSocket,!1),this.eventSocket.addEventListener(\"error\",this.handleEventSocketError,!1),this.eventSocket.addEventListener(\"message\",this.handleListenerEventMessage,!1),this.apiSocket=new WebSocket(this.apiUrl),this.apiSocket.addEventListener(\"open\",this.handleOpenApiSocket,!1),this.apiSocket.addEventListener(\"error\",this.handleApiSocketError,!1),this.apiSocket.addEventListener(\"message\",this.handleListenerApiMessage,!1)}outAndClear(){this.modianWorker&&(this.modianWorker.postMessage({type:\"cancel\"}),this.modianWorker.terminate(),this.modianWorker=null),null!==this.roomListenerTimer&&e.clearTimeout(this.roomListenerTimer),this.weiboWorker&&(this.weiboWorker.postMessage({type:\"cancel\"}),this.weiboWorker.terminate(),this.weiboWorker=null),this.timingMessagePushTimer&&this.timingMessagePushTimer.cancel(),this.eventSocket.removeEventListener(\"open\",this.handleOpenEventSocket),this.eventSocket.removeEventListener(\"error\",this.handleEventSocketError),this.eventSocket.removeEventListener(\"message\",this.handleListenerEventMessage),this.apiSocket.removeEventListener(\"open\",this.handleOpenApiSocket),this.apiSocket.removeEventListener(\"error\",this.handleApiSocketError),this.apiSocket.removeEventListener(\"message\",this.handleListenerApiMessage),this.eventSocket&&this.eventSocket.close(),this.apiSocket&&this.apiSocket.close()}async listenModianWorkerCbInformation(e){if(\"change\"===e.data.type)try{const{data:n,alreadyRaised:a,backerCount:i,endTime:c,timedifference:l}=e.data,{modianTemplate:d,isChouka:m,isChoukaSendImage:u}=this.option.basic,h=(Number(this.modianGoal)-Number(a)).toFixed(2),{cards:p,money:b,multiple:g,db:f}=this.choukaJson||{};for(let e=n.length-1;e>=0;e--){const t=n[e],E=[];let L=\"\";if(m){const e=await r.b(f,t.userid),n=0===e.length?{}:JSON.parse(e[0].record),a=Object(o.a)(p,b,Number(t.pay_amount),g);for(const t in a){const e=a[t],i=`【${e.level}】${e.name} * ${e.length}`;E.push(i),e.id in n?n[e.id]+=e.length:n[e.id]=e.length}if(u&&\"pro\"===this.coolqEdition)for(const t in a)L+=`[CQ:image,file=${a[t].image}]`;0===e.length?await r.a(f,t.userid,t.nickname,n):await r.d(f,t.userid,t.nickname,n)}const k=Object(s.e)(d,{id:t.nickname,money:t.pay_amount,modianname:this.modianTitle,modianid:this.option.basic.modianId,goal:this.modianGoal,alreadyraised:a,backercount:i,amountdifference:h,endtime:c,timedifference:l,chouka:`抽卡结果：\\n${E.join(\"\\n\")}${L}`});await this.sendMessage(k)}}catch(t){console.error(t)}}async listenRoomMessage(){var t;const n=(null==this?void 0:null===(t=this.option)||void 0===t?void 0:t.basic)||{},a=n.liveListeningInterval?1e3*n.liveListeningInterval:15e3;try{const t=await Object(i.d)(n.roomId,this.kouDai48Token);if(console.log(\"request: data2\",t),!(200===t.status&&\"content\"in t))return void(this.roomListenerTimer=e.setTimeout(this.listenRoomMessage.bind(this),a));if(!(t.content.message[0].msgTime>this.roomLastTime))return void(this.roomListenerTimer=e.setTimeout(this.listenRoomMessage.bind(this),a));const r=await Object(i.d)(n.roomId,this.kouDai48Token);if(console.log(\"request: data3\",r),!(200===r.status&&\"content\"in r))return void(this.roomListenerTimer=e.setTimeout(this.listenRoomMessage.bind(this),a));const c=[],l=r.content.message;for(let e=0,n=l.length;e<n;e++){const t=l[e];if(!(t.msgTime>this.roomLastTime))break;{const e=JSON.parse(t.extInfo),n=Object(s.f)(\"YY-MM-DD hh:mm:ss\",t.msgTime),{nickName:a}=e.user,{messageType:o}=e;switch(o){case\"TEXT\":c.push(`${e.user.nickName}：${e.text}\\n`+`时间：${n}`);break;case\"REPLY\":c.push(`${e.replyName}：${e.replyText}\\n`+`${a}：${e.text}\\n`+`时间：${n}`);break;case\"IMAGE\":const s=JSON.parse(t.bodys).url;let r=`${a}：`;this.option&&this.option.basic.isRoomSendImage&&\"pro\"===this.coolqEdition?r+=`\\n[CQ:image,file=${s}]\\n`:r+=`${s}\\n`,c.push(`${r}时间：${n}`);break;case\"AUDIO\":const l=JSON.parse(t.bodys).url;c.push(`${a} 发送了一条语音：${l}\\n`+`时间：${n}`),this.option&&this.option.basic.isRoomSendRecord&&\"pro\"===this.coolqEdition&&c.push(`[CQ:record,file=${l},magic=false]`);break;case\"VIDEO\":const d=JSON.parse(t.bodys).url;c.push(`${a} 发送了一个视频：${d}\\n`+`时间：${n}`);break;case\"LIVEPUSH\":c.push(`${a} 正在直播\\n`+`直播标题：${e.liveTitle}\\n`+`时间：${n}`);break;case\"FLIPCARD\":const m=await Object(i.c)(this.kouDai48Token,e.questionId,e.answerId),u=`${a} 翻牌了 ${m.content.userName}的问题：\\n`+`${e.question||m.content.question}\\n`+`回答：${e.answer||m.content.answer}`+`时间：${n}`;c.push(u);break;case\"EXPRESS\":c.push(`${a}：发送了一个表情。\\n`+`时间：${n}`);break;default:c.push(`${a}：未知信息类型，请联系开发者。\\n`+`时间：${n}`)}}}this.roomLastTime=l[0].msgTime;for(let e=c.length-1;e>=0;e--)await this.sendMessage(c[e])}catch(o){console.error(o)}this.roomListenerTimer=e.setTimeout(this.listenRoomMessage.bind(this),a)}async listenWeiboWorkerCbInformation(e){var t;const{isWeiboAtAll:n}=(null==this?void 0:null===(t=this.option)||void 0===t?void 0:t.basic)||{};if(\"change\"===e.data.type)try{const{data:t}=e.data;for(let e=t.length-1;e>=0;e--){const a=t[e];let i=a.data;n&&(i=`[CQ:at,qq=all] ${i}`),this.option&&this.option.basic.isWeiboSendImage&&\"pro\"===this.coolqEdition&&a.pics.length>0&&(i+=`[CQ:image,file=${a.pics[0]}]\\n`),await this.sendMessage(i)}}catch(a){console.error(a)}}async timingMessagePush(e){try{await this.sendMessage(e)}catch(t){console.error(t)}}}}).call(this,n(26))},433:function(e,t,n){\"use strict\";(function(e){const n=e.require(\"md5.js\"),a=\"das41aq6\";t.a=function(e){return e+`&sign=${(new n).update(e+\"&p=\"+a).digest(\"hex\").substr(5,16)}`}}).call(this,n(26))},434:function(e,t,n){e.exports=function(){return new Worker(n.p+\"a2c7f.worker.js\")}},435:function(e,t,n){\"use strict\";var a=n(0),i=n.n(a),s=n(3),o=n.n(s),r=n(232),c=n.n(r),l=n(312),d=n.n(l);function m(e){return e?i.a.createElement(\"span\",{className:d.a.on},\"开启\"):i.a.createElement(\"span\",{className:d.a.off},\"未开启\")}t.a=function(e){if(!e.detail)return null;const{detail:t}=e,{basic:n}=t;return i.a.createElement(\"table\",{className:d.a.detail},i.a.createElement(\"tbody\",null,i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:o()(d.a.td1,d.a.tdTitle)},\"配置名称\"),i.a.createElement(\"td\",{className:d.a.td2},t.name),i.a.createElement(\"td\",{className:o()(d.a.td1,d.a.tdTitle)},\"QQ号\"),i.a.createElement(\"td\",{className:d.a.td2},t.qqNumber)),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:o()(d.a.td1,d.a.tdTitle)},\"群号\"),i.a.createElement(\"td\",{className:d.a.td2},t.groupNumber),i.a.createElement(\"td\",{className:o()(d.a.td1,d.a.tdTitle)},\"socket端口\"),i.a.createElement(\"td\",{className:d.a.td2},t.socketPort)),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdGTitle,colSpan:4},\"摩点项目配置：\")),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"开启摩点项目监听功能\"),i.a.createElement(\"td\",null,m(n.isModian)),i.a.createElement(\"td\",{className:d.a.tdTitle},\"开启排行榜查询\"),i.a.createElement(\"td\",null,m(n.isModianLeaderboard))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"摩点项目ID\"),i.a.createElement(\"td\",{colSpan:3},n.modianId)),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"摩点项目命令\"),i.a.createElement(\"td\",{colSpan:3},i.a.createElement(\"pre\",null,n.modianUrlTemplate))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"摩点项目模板\"),i.a.createElement(\"td\",{colSpan:3},i.a.createElement(\"pre\",null,n.modianTemplate))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdGTitle,colSpan:4},\"摩点抽卡配置：\")),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"开启摩点抽卡功能\"),i.a.createElement(\"td\",null,m(n.isChouka)),i.a.createElement(\"td\",{className:d.a.tdTitle},\"发送图片\"),i.a.createElement(\"td\",null,m(n.isChoukaSendImage))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"卡牌信息文件地址\"),i.a.createElement(\"td\",{colSpan:3},i.a.createElement(\"pre\",null,n.choukaJson))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"允许补卡的QQ号\"),i.a.createElement(\"td\",{colSpan:3},i.a.createElement(\"pre\",null,n.bukaQQNumber))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdGTitle,colSpan:4},\"直播监听\")),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"开启口袋48直播监听功能\"),i.a.createElement(\"td\",null,m(n.is48LiveListener)),i.a.createElement(\"td\",{className:d.a.tdTitle},\"监听所有成员\"),i.a.createElement(\"td\",null,m(n.isListenerAll))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"@所有成员\"),i.a.createElement(\"td\",{colSpan:3},m(n.is48LiveAtAll))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"监听成员\"),i.a.createElement(\"td\",{colSpan:3},i.a.createElement(\"pre\",null,n.kd48LiveListenerMembers))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdGTitle,colSpan:4},\"成员房间信息监听\")),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"开启成员房间信息监听功能\"),i.a.createElement(\"td\",{colSpan:3},m(n.isRoomListener))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"房间ID\"),i.a.createElement(\"td\",null,n.roomId),i.a.createElement(\"td\",{className:d.a.tdTitle},\"监听间隔（秒）\"),i.a.createElement(\"td\",null,n.liveListeningInterval)),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"发送图片和图片链接（只限于酷QPro版本）\"),i.a.createElement(\"td\",null,m(n.isRoomSendImage)),i.a.createElement(\"td\",{className:d.a.tdTitle},\"发送语音和语音链接（只限于酷QPro版本）\"),i.a.createElement(\"td\",null,m(n.isRoomSendImage))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdGTitle,colSpan:4},\"微博监听\")),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"开启微博监听功能\"),i.a.createElement(\"td\",null,m(n.isWeiboListener)),i.a.createElement(\"td\",{className:d.a.tdTitle},\"@所有成员\"),i.a.createElement(\"td\",null,m(n.isWeiboAtAll))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"微博lfid\"),i.a.createElement(\"td\",null,n.lfid),i.a.createElement(\"td\",{className:d.a.tdTitle},\"发送图片\"),i.a.createElement(\"td\",null,m(n.isWeiboSendImage))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdGTitle,colSpan:4},\"欢迎新成员\")),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"开启欢迎新成员功能\"),i.a.createElement(\"td\",{colSpan:3},m(n.isNewGroupMember))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"欢迎词\"),i.a.createElement(\"td\",{colSpan:3},i.a.createElement(\"pre\",null,n.welcomeNewGroupMember))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdGTitle,colSpan:4},\"群内定时消息推送功能\")),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"开启群内定时消息推送功能\"),i.a.createElement(\"td\",null,m(n.isTimingMessagePush)),i.a.createElement(\"td\",{className:d.a.tdTitle},\"规则配置\"),i.a.createElement(\"td\",null,n.timingMessagePushFormat)),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"推送消息\"),i.a.createElement(\"td\",{colSpan:3},i.a.createElement(\"pre\",null,n.timingMessagePushText))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdGTitle,colSpan:4},\"帮助：\")),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdTitle},\"群内帮助命令\"),i.a.createElement(\"td\",{colSpan:3},m(n.isHelpCommend))),i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{className:d.a.tdGTitle,colSpan:4},\"自定义命令\")),function(e){const t=[];return c.a.each(e,(e,n)=>{t.push({command:e,text:n})}),0===t.length?i.a.createElement(\"tr\",null,i.a.createElement(\"td\",{colSpan:4},\"无自定义命令\")):t.map((e,t)=>i.a.createElement(\"tr\",{key:e.command},i.a.createElement(\"td\",null,e.command),i.a.createElement(\"td\",{colSpan:3},i.a.createElement(\"pre\",null,e.text))))}(t.custom)))}},436:function(e,t,n){\"use strict\";n.d(t,\"b\",function(){return m});var a=n(232),i=n.n(a),s=n(315),o=n(47),r=n(59),c=n(437),l=n.n(c);let d={};async function m(){try{const t=await Object(s.a)(0,!0);200===t.status&&\"liveList\"in t.content&&(d=function(e){const t={};return i.a.each(e,(e,n)=>{t[n.liveId]=n}),t}(t.content.liveList))}catch(e){console.error(e)}}t.a=async function(){try{const t=await Object(s.a)(0,!0);let n=[];200===t.status&&\"liveList\"in t.content&&(n=t.content.liveList);const a=new l.a,i=async e=>{const{newDataObj:t,newLive:n}=e.data;if(d=t,n.length>0){const e=r.a.getState().get(\"login\").get(\"qqLoginList\"),t=e instanceof Array?e:e.toJS();for(let a=n.length-1,i=t.length;a>=0;a--){const e=n[a];for(let n=0;n<i;n++){const a=t[n],i=a.option.basic;if(i.is48LiveListener&&(i.isListenerAll||a.members&&a.members.test(e.userInfo.nickname)||a.memberId&&a.memberId.includes(e.userId))){const t=Object(o.f)(\"YY-MM-DD hh:mm:ss\",Number(e.ctime)),n=a,r=await Object(s.b)(e.liveId);let c=`${e.userInfo.nickname} 开启了一个${1===e.liveType?\"直播\":\"电台\"}。\\n`+`直播标题：${e.title}\\n`+`开始时间：${t}\\n`+`视频地址：${r.content.playStreamPath}`;i.is48LiveAtAll&&(c=`[CQ:at,qq=all] ${c}`),await n.sendMessage(c)}}}}a.removeEventListener(\"message\",i),a.terminate()};a.addEventListener(\"message\",i,!1),a.postMessage({oldData:d,newData:n})}catch(e){console.error(e)}}},437:function(e,t,n){e.exports=function(){return new Worker(n.p+\"6791a.worker.js\")}},438:function(e,t,n){e.exports=function(){return new Worker(n.p+\"66b2b.worker.js\")}},439:function(e,t,n){e.exports=function(){return new Worker(n.p+\"4fa7f.worker.js\")}},463:function(e,t,n){\"use strict\";var a=n(314),i=n(47),s=n(434),o=n.n(s);var r=function(e,t){e[2]||(e[2]=\"20\");const{basic:n}=t.option;if(!n.isModian)return;const{isModianLeaderboard:s,modianId:r}=n;switch(e[1]){case\"0\":case\"项目信息\":s&&async function(e){const t=await Object(a.a)(e.option.basic.modianId);await e.sendMessage(`${e.modianTitle}: ￥${t.already_raised} / ￥${e.modianGoal}，`+`\\n集资人数：${t.backer_count}\\n项目截至日期：${t.end_time}`)}(t);break;case\"1\":case\"聚聚榜\":case\"2\":case\"打卡榜\":\"聚聚榜\"===e[1]?e[1]=\"1\":\"打卡榜\"===e[1]&&(e[1]=\"2\"),s&&function(e,t,n,a){try{const s=new o.a,r=async e=>{await a.sendMessage(e.data.text),s.removeEventListener(\"message\",r),s.terminate()};s.addEventListener(\"message\",r,!1),s.postMessage({proId:e,type:t,size:n,title:a.modianTitle})}catch(i){console.error(i)}}(r,e[1],e[2],t);break;case\"3\":case\"订单\":s&&function(e,t,n){const a=new o.a,i=async e=>{await n.sendMessage(e.data.text),a.removeEventListener(\"message\",i),a.terminate()};a.addEventListener(\"message\",i,!1),a.postMessage({proId:e,type:\"订单\",size:t,title:n.modianTitle})}(r,e[2],t);break;default:!async function(e){try{const n=Object(i.e)(e.option.basic.modianUrlTemplate,{modianname:e.modianTitle,modianid:e.option.basic.modianId});await e.sendMessage(n)}catch(t){console.error(t)}}(t)}},c=n(284),l=n(313);var d=async function(e,t,n){const{basic:a}=t.option;if(a.isChouka&&t.bukaQQNumber.includes(n.user_id)&&e[1]&&/^[0-9]+$/.test(e[1]))try{const{cards:n,money:s,multiple:o,db:r}=t.choukaJson,d=[];let m=\"\";const u=await c.b(r,e[1]),h=0===u.length?{}:JSON.parse(u[0].record),p=Object(l.a)(n,s,null,o,e[2]?Number(e[2]):1);for(const e in p){const t=p[e],n=`【${t.level}】${t.name} * ${t.length}`;d.push(n),t.id in h?h[t.id]+=t.length:h[t.id]=t.length}if(a.isChoukaSendImage)for(const e in p)m+=`[CQ:image,file=${p[e].image}]`;0===u.length?await c.a(r,e[1],\"\",h):await c.e(r,e[1],h),await t.sendMessage(`[${e[1]}]的补卡结果为：\\n${d.join(\"\\n\")}${m}`)}catch(i){console.error(i)}};var m=async function(e,t){const{basic:n}=t.option;if(!n.isChouka||!e[1])return;const{db:a,cards:i}=t.choukaJson,s=await c.c(a,e[1]);if(0===s.length)return void(await t.sendMessage(`[${e[1]}]：暂无卡片。`));const o=JSON.parse(s[0].record),r=[];for(let c=i.length-1;c>=0;c--){const e=i[c],t=[];let n=`【${e.level}】：`;for(const a of e.data)a.id in o&&o[a.id]>0&&t.push(`${a.name} * ${o[a.id]}`);t.length>0&&(n+=`\\n${t.join(\"\\n\")}`,r.push(n))}0!==r.length?await t.sendMessage(`[${\"\"===s[0].nickname?!e[1]:s[0].nickname}] 的查卡结果：\\n${r.join(\"\\n\")}`):await t.sendMessage(`[${!e[1]}] 的查卡结果：暂无卡片。`)},u=n(232),h=n.n(u),p=n(315);var b=function(e){e.option.basic.is48LiveListener&&async function(e){try{const n=await Object(p.a)(0,!0);let a=null;if(200===n.status)if(\"liveList\"in n.content&&n.content.liveList.length>0){const{liveList:e}=n.content;a=`口袋48直播：（当前直播成员数：${e.length}）`,h.a.each(e,(e,t)=>{a+=`\\n${e+1}、${t.userInfo.nickname}\\n`+`标题：${t.title}\\n`+`开始时间：${Object(i.f)(\"YY-MM-DD hh:mm:ss\",Number(t.ctime))}`})}else a=\"口袋48直播：\\n当前无直播。\";else a=\"[ERROR] 获取口袋48直播列表错误。'\";await e.sendMessage(a)}catch(t){console.error(t)}}(e)};var g=function(e,t){e[0]in t.option.custom&&t.sendMessage(t.option.custom[e[0]])};var f=async function(e){const{basic:t,custom:n}=e.option;if(t.isHelpCommend)try{const t=\"【帮助】\\n  · [摩点 或 集资 或 mod]:查看当前微打赏链接\\n  · [(摩点 或 集资 或 mod) (0 或 项目信息)]:查看当前已集资数\\n  · [(摩点 或 集资 或 mod) (1 或 聚聚榜) ?number]:查看聚聚榜\\n  · [(摩点 或 集资 或 mod) (2 或 打卡榜) ?number]:查看打卡榜\\n  · [(摩点 或 集资 或 mod) (3 或 订单) ?number]:订单查询\\n  · [补卡 摩点ID number]:补卡\\n  · [查卡 (摩点ID 或 摩点昵称)]:查卡\\n  · [直播列表 或 zb]:查看当前的口袋48直播列表\\n  · [help]：帮助\";if(await e.sendMessage(t),Object.values(n).length>0){let t=\"【自定义命令】\";h.a.each(n,(e,n)=>{t+=\"\\n · \"+e}),await e.sendMessage(t)}}catch(a){console.error(a)}};t.a=function(e,t){const n=((null==e?void 0:e.raw_message)||e.message).split(/\\s+/);for(let a=n.length-1;a>=0;a--)\"\"===n[a]&&n.splice(a,1);!function(e,t,n){switch(e[0]){case\"摩点\":case\"集资\":case\"mod\":r(e,t);break;case\"补卡\":d(e,t,n);break;case\"查卡\":m(e,t);break;case\"直播列表\":case\"zb\":b(t);break;case\"help\":f(t);break;default:g(e,t)}}(n,t,e)}},465:function(e,t,n){\"use strict\";n.r(t);var a,i=n(0),s=n.n(i),o=n(30),r=n(255),c=n(271),l=n(319),d=n(430);let m=Object(r.a)(c.c)(a=class extends i.Component{render(){return s.a.createElement(o.c,null,s.a.createElement(o.a,{path:\"/Login\",component:l.a,exact:!0}),s.a.createElement(o.a,{path:\"/Login/Login\",component:d.a,exact:!0}))}})||a;t.default=m}}]);","extractedComments":[]}