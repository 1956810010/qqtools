{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{250:function(e,a,t){e.exports={toolsBox:\"_2OOgf\",tableBox:\"_3locr\",fl:\"_2If2e\",fr:\"_2v1iu\",mr10:\"_R-c_O\",ml10:\"_k05_a\",affix:\"_2kc2R\"}},255:function(e,a,t){\"use strict\";var n=t(233),o=t(0),r=t.n(o),i=t(1),c=t.n(i);a.a=function(e){return function(a){var t,i;return i=t=class extends o.Component{constructor(){var a;super(...arguments);const t=(null==this?void 0:null===(a=this.props)||void 0===a?void 0:a.injectReducers)||null;t&&t(e)}render(){return r.a.createElement(a,null)}},Object(n.a)(t,\"propTypes\",{injectReducers:c.a.func}),i}}},265:function(e,a,t){\"use strict\";(function(e){t.d(a,\"b\",function(){return i}),t.d(a,\"a\",function(){return c}),t.d(a,\"d\",function(){return s}),t.d(a,\"c\",function(){return l}),t.d(a,\"e\",function(){return m});const n=e.require(\"request\"),o={method:\"POST\",json:!0};function r(e){return{\"Content-Type\":\"application/json;charset=utf-8\",appInfo:JSON.stringify({vendor:\"apple\",deviceId:`${Math.floor(1e10*Math.random())}`,appVersion:\"6.0.0\",appBuild:\"190409\",osVersion:\"11.4.1\",osType:\"ios\",deviceName:\"iPhone 6s\",os:\"ios\"}),token:e}}function i(e,a){return new Promise((t,i)=>{n({...o,headers:r(),uri:\"https://pocketapi.48.cn/user/api/v1/login/app/mobile\",body:{mobile:e,pwd:a}},(e,a,n)=>{e?i(e):t(n)})}).catch(e=>{console.error(e)})}function c(e){return new Promise((a,t)=>{n({...o,headers:r(e),uri:\"https://pocketapi.48.cn/user/api/v1/friendships/friends/id\",body:{}},(e,n,o)=>{e?t(e):a(o)})}).catch(e=>{console.error(e)})}function s(e,a){return new Promise((t,o)=>{n({uri:\"https://pocketapi.48.cn/im/api/v1/chatroom/msg/list/homeowner\",method:\"POST\",headers:r(a),json:!0,body:{needTop1Msg:!1,roomId:e,nextTime:0}},(e,a,n)=>{e?o(e):t(n)})}).catch(e=>{console.error(e)})}function l(e,a,t){return new Promise((o,i)=>{n({uri:\"https://pocketapi.48.cn/idolanswer/api/idolanswer/v1/question_answer/detail\",method:\"POST\",headers:r(e),json:!0,body:{questionId:a,answerId:t}},(e,a,t)=>{e?i(e):o(t)}).catch(e=>{console.error(e)})})}function m(e){return new Promise((a,t)=>{n({uri:\"https://pocketapi.48.cn/im/api/v1/conversation/page\",method:\"POST\",headers:r(e),json:!0,body:{targetType:0}},(e,n,o)=>{e?t(e):a(o)})}).catch(e=>{console.error(e)})}}).call(this,t(26))},287:function(e,a,t){e.exports={box:\"_3PTEx\",body:\"_2g1IU\",inforP:\"_2cqS_\",mb10:\"_36SyC\",keyName:\"_11RdS\",mr20:\"_1AwO2\",loadingText:\"_Z71jO\",searchId:\"_kAmOG\",searchGroup:\"_w3N8f\",searchText:\"_32Z79\",infoBox:\"_1rg2z\",infoTable:\"_3bl3U\"}},468:function(e,a,t){\"use strict\";t.r(a);var n=t(0),o=t.n(n),r=t(30),i=t(255),c=t(469),s=t(466),l=t(39),m=t(87),d=t(134);const u={objectStoreName:m.a.indexeddb.objectStore[2].name},p={objectStoreName:m.a.indexeddb.objectStore[1].name},f=Object(c.a)(\"登录信息\"),h=d.a.getAction({...u,successAction:f}),b=d.a.putAction({...u,successAction:f}),I=d.a.clearAction(u),g=d.a.getAction(p),E=d.a.addAction(p),v=d.a.cursorAction(p),y=d.a.clearAction(p);var k={kouDai48:Object(s.a)({[f]:(e,a)=>{const t=\"data\"in a.payload?a.payload.data:a.payload.result;return e.set(\"loginInformation\",t||null)}},Object(l.fromJS)({loginInformation:null}))},w=(t(136),t(94)),N=(t(268),t(266)),j=(t(137),t(44)),x=(t(237),t(234)),O=(t(241),t(245)),S=(t(258),t(269)),P=(t(270),t(259)),T=(t(238),t(236)),_=(t(286),t(289)),C=(t(252),t(253)),M=t(233),A=(t(242),t(244)),D=t(1),R=t.n(D),B=t(32),q=t(84),L=t(7),F=t(249),J=t(3),z=t.n(J),G=t(250),K=t.n(G),U=t(287),V=t.n(U);var Z,Q,$,H=function(e){var a,t;const n=e.loginInformation;return o.a.createElement(x.a,{title:\"登录信息\"},n?[o.a.createElement(\"p\",{key:\"0\",className:V.a.inforP},\"ID: \",null==n?void 0:null===(a=n.userInfo)||void 0===a?void 0:a.userId),o.a.createElement(\"p\",{key:\"1\",className:V.a.inforP},\"昵称: \",null==n?void 0:null===(t=n.userInfo)||void 0===t?void 0:t.nickname),o.a.createElement(\"p\",{key:\"2\",className:V.a.inforP},\"Token: \",null==n?void 0:n.token)]:o.a.createElement(\"p\",null,\"暂无登录记录\"))};const W=Object(F.b)({});var X,Y,ee,ae=Object(q.b)(W,e=>({action:Object(B.b)({getMemberInformation:g,addMemberInformation:E},e)}))(($=Q=class extends n.Component{findRoomIdByMemberId(e){const{roomPage:a=[]}=this.props;let t=null,n=null;for(const o of a)if(e===Number(o.ownerId)){t=o.targetId,n=o.ownerName;break}return{id:t,name:n}}render(){const{item:e}=this.props,{name:a,id:t}=this.findRoomIdByMemberId(Number(e.memberId));return e?\"\"!==a?[o.a.createElement(\"b\",{key:\"0\",className:V.a.keyName},\"memberName:\"),o.a.createElement(\"span\",{key:\"1\",className:V.a.mr20},a||\"---\"),o.a.createElement(\"b\",{key:\"2\",className:V.a.keyName},\"roomId:\"),o.a.createElement(\"span\",{key:\"3\"},t||\"---\")]:null:o.a.createElement(\"span\",{className:V.a.loadingText},\"加载中...\")}},Object(M.a)(Q,\"propTypes\",{item:R.a.object,roomPage:R.a.array}),Z=$))||Z,te=t(265);function ne(e,a,t){if(0===e.length)return[];if(a===t)return[{memberId:e[a]}];const n=Math.floor((t-a)/2)+a,o=ne(e,a,n),r=ne(e,n+1,t);return o.concat(r)}const oe=Object(F.b)({loginInformation:Object(F.a)(e=>e.has(\"kouDai48\")?e.get(\"kouDai48\"):null,e=>null!==e?e.get(\"loginInformation\"):null)});var re,ie=A.a.create()(X=Object(q.b)(oe,e=>({action:Object(B.b)({loginInformation:f,getLoginInformation:h,putLoginInformation:b,cursorMemberInformation:v,clearLoginInformation:I,clearMemberInformation:y},e)}))((ee=Y=class extends n.Component{constructor(){super(...arguments),this.state={searchString:\"\",searchResult:[]}}componentDidMount(){this.props.action.getLoginInformation({query:\"loginInformation\"})}columns(){var e,a,t;const n=(null===(e=this.props)||void 0===e?void 0:null===(a=e.loginInformation)||void 0===a?void 0:null===(t=a.value)||void 0===t?void 0:t.roomPage)||[];return[{title:\"memberId\",dataIndex:\"memberId\",key:\"memberId\",width:\"20%\"},{title:\"information\",key:\"information\",width:\"80%\",render:(e,a,t)=>o.a.createElement(ae,{item:a,roomPage:n})}]}handleSubmit(e){e.preventDefault(),this.props.form.validateFields(async(e,a)=>{if(!e)try{const t=await Object(te.b)(a.account,a.password);if(200!==t.status)return void C.a.warn(t.message);const{content:n}=t,o=n.token||n.userInfo.token,[r,i]=await Promise.all([Object(te.a)(o),Object(te.e)(o)]),c={key:\"loginInformation\",value:{friends:r.content.data,token:o,userInfo:n.userInfo,roomPage:i.content.conversations}};await this.props.action.putLoginInformation({data:c}),this.props.form.resetFields(),C.a.success(\"登陆成功！\")}catch(e){C.a.error(\"登陆失败！\"),console.error(e)}})}handleInputChange(e){this.setState({searchString:e.target.value})}findRoomIdByMemberId(e){var a,t,n;const o=(null===(a=this.props)||void 0===a?void 0:null===(t=a.loginInformation)||void 0===t?void 0:null===(n=t.value)||void 0===n?void 0:n.roomPage)||[],r=[];for(const i of o)i.ownerName.includes(e)&&r.push(i);return r}handleSearchInformationClick(e){const{searchString:a}=this.state,t=this.findRoomIdByMemberId(a);t&&t.length>0?_.a.info({title:\"搜索结果\",centered:!0,content:o.a.createElement(\"div\",{className:V.a.infoBox},o.a.createElement(\"table\",{className:V.a.infoTable},o.a.createElement(\"thead\",null,o.a.createElement(\"tr\",null,o.a.createElement(\"th\",null,\"小偶像名字\"),o.a.createElement(\"th\",null,\"小偶像ID\"),o.a.createElement(\"th\",null,\"房间ID\"))),o.a.createElement(\"tbody\",null,t.map((e,a)=>o.a.createElement(\"tr\",{key:e.ownerId},o.a.createElement(\"td\",null,e.ownerName),o.a.createElement(\"td\",null,e.ownerId),o.a.createElement(\"td\",null,e.targetId))))))}):C.a.info(\"没有数据\")}async handleExitAndClearClick(e){try{await this.props.action.clearLoginInformation(),await this.props.action.clearMemberInformation(),this.props.action.loginInformation({data:null})}catch(a){console.error(a)}}render(){const{getFieldDecorator:e}=this.props.form,a=this.props.loginInformation,t=[];return this.state.searchResult.map((e,a)=>{t.push(o.a.createElement(\"div\",{key:e.memberId,className:V.a.searchGroup},o.a.createElement(\"p\",{className:V.a.searchText},\"memberId: \",e.memberId),o.a.createElement(\"p\",{className:V.a.searchText},\"memberName: \",e.memberName),o.a.createElement(\"p\",{className:V.a.searchText},\"roomId: \",e.roomId)))}),o.a.createElement(n.Fragment,null,o.a.createElement(S.a,{className:K.a.affix},o.a.createElement(\"div\",{className:z()(K.a.toolsBox,\"clearfix\")},o.a.createElement(\"div\",{className:K.a.fr},o.a.createElement(P.a,{title:\"确定退出登录并清除缓存吗？\",onConfirm:this.handleExitAndClearClick.bind(this)},o.a.createElement(T.a,{icon:\"warning\"},\"退出登录并清除缓存\")),o.a.createElement(L.b,{className:K.a.ml10,to:\"/\"},o.a.createElement(T.a,{type:\"danger\",icon:\"poweroff\"},\"返回\"))))),o.a.createElement(\"div\",{className:V.a.box},o.a.createElement(w.a,{className:V.a.body,gutter:10},o.a.createElement(j.a,{span:12},o.a.createElement(x.a,{className:V.a.mb10,title:\"口袋48登录\"},o.a.createElement(\"p\",{className:V.a.mb10},\"在使用口袋48的房间监听功能前，必须先登录，获取token，否则无法获取到房间信息。\"),o.a.createElement(\"p\",{className:V.a.mb10},\"登录一次后，token会储存在本地，不需要重复登录。\"),o.a.createElement(A.a,{onSubmit:this.handleSubmit.bind(this)},o.a.createElement(A.a.Item,{label:\"用户名\"},e(\"account\",{rules:[{message:\"必须输入用户名\",required:!0,whitespace:!0}]})(o.a.createElement(O.a,null))),o.a.createElement(A.a.Item,{label:\"密码\"},e(\"password\",{rules:[{message:\"必须输入密码\",required:!0,whitespace:!0}]})(o.a.createElement(O.a.Password,null))),o.a.createElement(T.a,{type:\"primary\",htmlType:\"submit\"},\"登录\"))),o.a.createElement(H,{loginInformation:a?a.value:null})),o.a.createElement(j.a,{span:12},o.a.createElement(x.a,{className:V.a.mb10,title:\"ID搜索\"},o.a.createElement(\"div\",null,o.a.createElement(\"label\",{htmlFor:\"koudai48-search\"},\"在数据库中搜索小偶像的相关信息，请输入小偶像的名字：\"),o.a.createElement(O.a,{className:V.a.searchId,id:\"koudai48-search\",value:this.state.searchString,onChange:this.handleInputChange.bind(this),onPressEnter:this.handleSearchInformationClick.bind(this)}),o.a.createElement(T.a,{className:K.a.ml10,type:\"primary\",onClick:this.handleSearchInformationClick.bind(this)},\"搜索\"),t)),o.a.createElement(N.a,{columns:this.columns(),size:\"middle\",rowKey:e=>e.memberId,bordered:!0,dataSource:a?ne(a.value.friends,0,a.value.friends.length-1):[],pagination:{defaultPageSize:10,showQuickJumper:!0}})))))}},Object(M.a)(Y,\"propTypes\",{loginInformation:R.a.object,action:R.a.objectOf(R.a.func),form:R.a.object}),X=ee))||X)||X;let ce=Object(i.a)(k)(re=class extends n.Component{render(){return o.a.createElement(r.c,null,o.a.createElement(r.a,{path:\"/KouDai48\",component:ie,exact:!0}))}})||re;a.default=ce}}]);","extractedComments":[]}