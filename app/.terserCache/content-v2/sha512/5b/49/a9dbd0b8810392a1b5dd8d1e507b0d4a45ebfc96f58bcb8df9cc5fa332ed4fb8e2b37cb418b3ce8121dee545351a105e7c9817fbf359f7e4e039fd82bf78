{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{250:function(e,t,a){e.exports={toolsBox:\"_2OOgf\",tableBox:\"_3locr\",fl:\"_2If2e\",fr:\"_2v1iu\",mr10:\"_R-c_O\",ml10:\"_k05_a\",affix:\"_2kc2R\"}},255:function(e,t,a){\"use strict\";var n=a(233),o=a(0),r=a.n(o),i=a(1),c=a.n(i);t.a=function(e){return function(t){var a,i;return i=a=class extends o.Component{constructor(){var t;super(...arguments);const a=(null==this?void 0:null===(t=this.props)||void 0===t?void 0:t.injectReducers)||null;a&&a(e)}render(){return r.a.createElement(t,null)}},Object(n.a)(a,\"propTypes\",{injectReducers:c.a.func}),i}}},265:function(e,t,a){\"use strict\";(function(e){a.d(t,\"b\",function(){return i}),a.d(t,\"a\",function(){return c}),a.d(t,\"d\",function(){return s}),a.d(t,\"c\",function(){return l}),a.d(t,\"e\",function(){return m});const n=e.require(\"request\"),o={method:\"POST\",json:!0};function r(e){return{\"Content-Type\":\"application/json;charset=utf-8\",appInfo:JSON.stringify({vendor:\"apple\",deviceId:`${Math.floor(1e10*Math.random())}`,appVersion:\"6.0.0\",appBuild:\"190409\",osVersion:\"11.4.1\",osType:\"ios\",deviceName:\"iPhone 6s\",os:\"ios\"}),token:e}}function i(e,t){return new Promise((a,i)=>{n({...o,headers:r(),uri:\"https://pocketapi.48.cn/user/api/v1/login/app/mobile\",body:{mobile:e,pwd:t},gzip:!0,timeout:6e4},(e,t,n)=>{e?i(e):a(n)})}).catch(e=>{console.error(e)})}function c(e){return new Promise((t,a)=>{n({...o,headers:r(e),uri:\"https://pocketapi.48.cn/user/api/v1/friendships/friends/id\",body:{},gzip:!0,timeout:15e3},(e,n,o)=>{e?a(e):t(o)})}).catch(e=>{console.error(e)})}function s(e,t){return new Promise((a,o)=>{n({uri:\"https://pocketapi.48.cn/im/api/v1/chatroom/msg/list/homeowner\",method:\"POST\",headers:r(t),json:!0,body:{needTop1Msg:!1,roomId:e,nextTime:0},gzip:!0,timeout:15e3},(e,t,n)=>{e?o(e):a(n)})}).catch(e=>{console.error(e)})}function l(e,t,a){return new Promise((o,i)=>{n({uri:\"https://pocketapi.48.cn/idolanswer/api/idolanswer/v1/question_answer/detail\",method:\"POST\",headers:r(e),json:!0,body:{questionId:t,answerId:a},gzip:!0,timeout:15e3},(e,t,a)=>{e?i(e):o(a)})}).catch(e=>{console.error(e)})}function m(e){return new Promise((t,a)=>{n({uri:\"https://pocketapi.48.cn/im/api/v1/conversation/page\",method:\"POST\",headers:r(e),json:!0,body:{targetType:0},gzip:!0,timeout:6e4},(e,n,o)=>{e?a(e):t(o)})}).catch(e=>{console.error(e)})}}).call(this,a(26))},287:function(e,t,a){e.exports={box:\"_3PTEx\",body:\"_2g1IU\",inforP:\"_2cqS_\",mb10:\"_36SyC\",keyName:\"_11RdS\",mr20:\"_1AwO2\",loadingText:\"_Z71jO\",searchId:\"_kAmOG\",searchGroup:\"_w3N8f\",searchText:\"_32Z79\",infoBox:\"_1rg2z\",infoTable:\"_3bl3U\"}},468:function(e,t,a){\"use strict\";a.r(t);var n=a(0),o=a.n(n),r=a(30),i=a(255),c=a(469),s=a(466),l=a(39),m=a(87),d=a(134);const u={objectStoreName:m.a.indexeddb.objectStore[2].name},p={objectStoreName:m.a.indexeddb.objectStore[1].name},f=Object(c.a)(\"登录信息\"),h=d.a.getAction({...u,successAction:f}),b=d.a.putAction({...u,successAction:f}),I=d.a.clearAction(u),g=d.a.getAction(p),E=d.a.addAction(p),v=d.a.cursorAction(p),y=d.a.clearAction(p);var k={kouDai48:Object(s.a)({[f]:(e,t)=>{const a=\"data\"in t.payload?t.payload.data:t.payload.result;return e.set(\"loginInformation\",a||null)}},Object(l.fromJS)({loginInformation:null}))},w=(a(136),a(94)),N=(a(268),a(266)),j=(a(137),a(44)),x=(a(237),a(234)),O=(a(241),a(245)),S=(a(258),a(269)),P=(a(270),a(259)),T=(a(238),a(236)),_=(a(286),a(289)),C=(a(252),a(253)),M=a(233),A=(a(242),a(244)),D=a(1),R=a.n(D),B=a(32),q=a(84),z=a(7),L=a(249),F=a(3),J=a.n(F),G=a(250),K=a.n(G),U=a(287),V=a.n(U);var Z,Q,$,H=function(e){var t,a;const n=e.loginInformation;return o.a.createElement(x.a,{title:\"登录信息\"},n?[o.a.createElement(\"p\",{key:\"0\",className:V.a.inforP},\"ID: \",null==n?void 0:null===(t=n.userInfo)||void 0===t?void 0:t.userId),o.a.createElement(\"p\",{key:\"1\",className:V.a.inforP},\"昵称: \",null==n?void 0:null===(a=n.userInfo)||void 0===a?void 0:a.nickname),o.a.createElement(\"p\",{key:\"2\",className:V.a.inforP},\"Token: \",null==n?void 0:n.token)]:o.a.createElement(\"p\",null,\"暂无登录记录\"))};const W=Object(L.b)({});var X,Y,ee,te=Object(q.b)(W,e=>({action:Object(B.b)({getMemberInformation:g,addMemberInformation:E},e)}))(($=Q=class extends n.Component{findRoomIdByMemberId(e){const{roomPage:t=[]}=this.props;let a=null,n=null;for(const o of t)if(e===Number(o.ownerId)){a=o.targetId,n=o.ownerName;break}return{id:a,name:n}}render(){const{item:e}=this.props,{name:t,id:a}=this.findRoomIdByMemberId(Number(e.memberId));return e?\"\"!==t?[o.a.createElement(\"b\",{key:\"0\",className:V.a.keyName},\"memberName:\"),o.a.createElement(\"span\",{key:\"1\",className:V.a.mr20},t||\"---\"),o.a.createElement(\"b\",{key:\"2\",className:V.a.keyName},\"roomId:\"),o.a.createElement(\"span\",{key:\"3\"},a||\"---\")]:null:o.a.createElement(\"span\",{className:V.a.loadingText},\"加载中...\")}},Object(M.a)(Q,\"propTypes\",{item:R.a.object,roomPage:R.a.array}),Z=$))||Z,ae=a(265);function ne(e,t,a){if(0===e.length)return[];if(t===a)return[{memberId:e[t]}];const n=Math.floor((a-t)/2)+t,o=ne(e,t,n),r=ne(e,n+1,a);return o.concat(r)}const oe=Object(L.b)({loginInformation:Object(L.a)(e=>e.has(\"kouDai48\")?e.get(\"kouDai48\"):null,e=>null!==e?e.get(\"loginInformation\"):null)});var re,ie=A.a.create()(X=Object(q.b)(oe,e=>({action:Object(B.b)({loginInformation:f,getLoginInformation:h,putLoginInformation:b,cursorMemberInformation:v,clearLoginInformation:I,clearMemberInformation:y},e)}))((ee=Y=class extends n.Component{constructor(){super(...arguments),this.state={searchString:\"\",searchResult:[]}}componentDidMount(){this.props.action.getLoginInformation({query:\"loginInformation\"})}columns(){var e,t,a;const n=(null===(e=this.props)||void 0===e?void 0:null===(t=e.loginInformation)||void 0===t?void 0:null===(a=t.value)||void 0===a?void 0:a.roomPage)||[];return[{title:\"memberId\",dataIndex:\"memberId\",key:\"memberId\",width:\"20%\"},{title:\"information\",key:\"information\",width:\"80%\",render:(e,t,a)=>o.a.createElement(te,{item:t,roomPage:n})}]}handleSubmit(e){e.preventDefault(),this.props.form.validateFields(async(e,t)=>{if(!e)try{const a=await Object(ae.b)(t.account,t.password);if(200!==a.status)return void C.a.warn(a.message);const{content:n}=a,o=n.token||n.userInfo.token,[r,i]=await Promise.all([Object(ae.a)(o),Object(ae.e)(o)]),c={key:\"loginInformation\",value:{friends:r.content.data,token:o,userInfo:n.userInfo,roomPage:i.content.conversations}};await this.props.action.putLoginInformation({data:c}),this.props.form.resetFields(),C.a.success(\"登陆成功！\")}catch(e){C.a.error(\"登陆失败！\"),console.error(e)}})}handleInputChange(e){this.setState({searchString:e.target.value})}findRoomIdByMemberId(e){var t,a,n;const o=(null===(t=this.props)||void 0===t?void 0:null===(a=t.loginInformation)||void 0===a?void 0:null===(n=a.value)||void 0===n?void 0:n.roomPage)||[],r=[];for(const i of o)i.ownerName.includes(e)&&r.push(i);return r}handleSearchInformationClick(e){const{searchString:t}=this.state,a=this.findRoomIdByMemberId(t);a&&a.length>0?_.a.info({title:\"搜索结果\",centered:!0,content:o.a.createElement(\"div\",{className:V.a.infoBox},o.a.createElement(\"table\",{className:V.a.infoTable},o.a.createElement(\"thead\",null,o.a.createElement(\"tr\",null,o.a.createElement(\"th\",null,\"小偶像名字\"),o.a.createElement(\"th\",null,\"小偶像ID\"),o.a.createElement(\"th\",null,\"房间ID\"))),o.a.createElement(\"tbody\",null,a.map((e,t)=>o.a.createElement(\"tr\",{key:e.ownerId},o.a.createElement(\"td\",null,e.ownerName),o.a.createElement(\"td\",null,e.ownerId),o.a.createElement(\"td\",null,e.targetId))))))}):C.a.info(\"没有数据\")}async handleExitAndClearClick(e){try{await this.props.action.clearLoginInformation(),await this.props.action.clearMemberInformation(),this.props.action.loginInformation({data:null})}catch(t){console.error(t)}}render(){const{getFieldDecorator:e}=this.props.form,t=this.props.loginInformation,a=[];return this.state.searchResult.map((e,t)=>{a.push(o.a.createElement(\"div\",{key:e.memberId,className:V.a.searchGroup},o.a.createElement(\"p\",{className:V.a.searchText},\"memberId: \",e.memberId),o.a.createElement(\"p\",{className:V.a.searchText},\"memberName: \",e.memberName),o.a.createElement(\"p\",{className:V.a.searchText},\"roomId: \",e.roomId)))}),o.a.createElement(n.Fragment,null,o.a.createElement(S.a,{className:K.a.affix},o.a.createElement(\"div\",{className:J()(K.a.toolsBox,\"clearfix\")},o.a.createElement(\"div\",{className:K.a.fr},o.a.createElement(P.a,{title:\"确定退出登录并清除缓存吗？\",onConfirm:this.handleExitAndClearClick.bind(this)},o.a.createElement(T.a,{icon:\"warning\"},\"退出登录并清除缓存\")),o.a.createElement(z.b,{className:K.a.ml10,to:\"/\"},o.a.createElement(T.a,{type:\"danger\",icon:\"poweroff\"},\"返回\"))))),o.a.createElement(\"div\",{className:V.a.box},o.a.createElement(w.a,{className:V.a.body,gutter:10},o.a.createElement(j.a,{span:12},o.a.createElement(x.a,{className:V.a.mb10,title:\"口袋48登录\"},o.a.createElement(\"p\",{className:V.a.mb10},\"在使用口袋48的房间监听功能前，必须先登录，获取token，否则无法获取到房间信息。\"),o.a.createElement(\"p\",{className:V.a.mb10},\"登录一次后，token会储存在本地，不需要重复登录。\"),o.a.createElement(A.a,{onSubmit:this.handleSubmit.bind(this)},o.a.createElement(A.a.Item,{label:\"用户名\"},e(\"account\",{rules:[{message:\"必须输入用户名\",required:!0,whitespace:!0}]})(o.a.createElement(O.a,null))),o.a.createElement(A.a.Item,{label:\"密码\"},e(\"password\",{rules:[{message:\"必须输入密码\",required:!0,whitespace:!0}]})(o.a.createElement(O.a.Password,null))),o.a.createElement(T.a,{type:\"primary\",htmlType:\"submit\"},\"登录\"))),o.a.createElement(H,{loginInformation:t?t.value:null})),o.a.createElement(j.a,{span:12},o.a.createElement(x.a,{className:V.a.mb10,title:\"ID搜索\"},o.a.createElement(\"div\",null,o.a.createElement(\"label\",{htmlFor:\"koudai48-search\"},\"在数据库中搜索小偶像的相关信息，请输入小偶像的名字：\"),o.a.createElement(O.a,{className:V.a.searchId,id:\"koudai48-search\",value:this.state.searchString,onChange:this.handleInputChange.bind(this),onPressEnter:this.handleSearchInformationClick.bind(this)}),o.a.createElement(T.a,{className:K.a.ml10,type:\"primary\",onClick:this.handleSearchInformationClick.bind(this)},\"搜索\"),a)),o.a.createElement(N.a,{columns:this.columns(),size:\"middle\",rowKey:e=>e.memberId,bordered:!0,dataSource:t?ne(t.value.friends,0,t.value.friends.length-1):[],pagination:{defaultPageSize:10,showQuickJumper:!0}})))))}},Object(M.a)(Y,\"propTypes\",{loginInformation:R.a.object,action:R.a.objectOf(R.a.func),form:R.a.object}),X=ee))||X)||X;let ce=Object(i.a)(k)(re=class extends n.Component{render(){return o.a.createElement(r.c,null,o.a.createElement(r.a,{path:\"/KouDai48\",component:ie,exact:!0}))}})||re;t.default=ce}}]);","extractedComments":[]}