{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{235:function(e,t,a){e.exports={toolsBox:\"_14-Ls\",tableBox:\"_2Gy1Q\",fl:\"_18ATS\",fr:\"_VYDZ6\",mr10:\"_1Kii0\",ml10:\"_1-Wdi\",affix:\"_xTYxE\"}},243:function(e,t,a){\"use strict\";(function(e){function n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){r(e,t,a[t])})}return e}function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,\"a\",function(){return s}),a.d(t,\"b\",function(){return m}),a.d(t,\"d\",function(){return l}),a.d(t,\"c\",function(){return u});const o=e.require(\"request\"),i={os:\"android\",IMEI:\"864394020501237\",version:\"5.0.0\",Connection:\"Keep-Alive\"},c={method:\"POST\",headers:i,json:!0};function s(e,t){return new Promise((a,r)=>{o(n({},c,{uri:\"https://puser.48.cn/usersystem/api/user/v1/login/phone\",body:{password:t,account:e,longitude:0,latitude:0}}),(e,t,n)=>{e?r(e):a(n)})}).catch(e=>{console.error(e)})}function m(e){return new Promise((t,a)=>{o(n({},c,{uri:\"https://puser.48.cn/usersystem/api/user/member/v1/fans/room\",body:{memberId:e}}),(e,n,r)=>{e?a(e):t(r)})}).catch(e=>{console.error(e)})}function l(e){return new Promise((t,a)=>{o(n({},c,{uri:`https://puser.48.cn/usersystem/api/user/v1/show/info/${e}`,body:{needRecommend:!1,needChatInfo:!1,needFriendsNum:!1}}),(e,n,r)=>{e?a(e):t(r)})}).catch(e=>{console.error(e)})}function u(e,t,a=1){return new Promise((r,c)=>{o({uri:\"https://pjuju.48.cn/imsystem/api/im/v1/member/room/message/mainpage\",method:\"POST\",headers:n({},i,{token:t}),json:!0,body:{roomId:e,chatType:0,lastTime:0,limit:a}},(e,t,a)=>{e?c(e):r(a)})}).catch(e=>{console.error(e)})}}).call(this,a(28))},272:function(e,t,a){e.exports={box:\"_1k3HS\",body:\"_8b9Bl\",inforP:\"_138Lo\",mb10:\"_1Xx4V\",keyName:\"_3txoz\",mr20:\"_4TT3e\",loadingText:\"_1p1Am\",searchId:\"_2sITn\",searchGroup:\"_1po7d\",searchText:\"_3LbjC\"}},472:function(e,t,a){\"use strict\";a.r(t);var n=a(0),r=a.n(n),o=a(477),i=a(469),c=(a(127),a(85)),s=(a(258),a(256)),m=(a(128),a(39)),l=(a(308),a(304)),u=(a(244),a(307)),d=(a(245),a(261)),b=(a(260),a(247)),p=(a(122),a(75)),f=(a(78),a(42)),h=(a(309),a(303)),I=a(1),y=a.n(I),g=a(29),E=a(81),N=a(468),v=a(123),w=a(8),k=a.n(w),S=a(235),j=a.n(S),O=a(272),x=a.n(O),P=a(476),_=a(471),T=a(35),C=a(34),A=a(124);function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){D(e,t,a[t])})}return e}function D(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const L={objectStoreName:C.a.indexeddb.objectStore[2].name},F={objectStoreName:C.a.indexeddb.objectStore[1].name},q=Object(P.a)(\"登录信息\"),B=A.a.getAction(M({},L,{successAction:q})),J=A.a.putAction(M({},L,{successAction:q})),K=A.a.clearAction(L),R=A.a.getAction(F),z=A.a.addAction(F),G=A.a.cursorAction(F),W=A.a.clearAction(F);var Q={kouDai48:Object(_.a)({[q]:(e,t)=>{const a=\"data\"in t.payload?t.payload.data:t.payload.result;return e.set(\"loginInformation\",a||null)}},Object(T.fromJS)({loginInformation:null}))};var U,V=e=>{var t,a;const n=e.loginInformation;return r.a.createElement(l.a,{title:\"登录信息\"},n?[r.a.createElement(\"p\",{key:\"0\",className:x.a.inforP},\"ID: \",null==n?void 0:null===(t=n.userInfo)||void 0===t?void 0:t.userId),r.a.createElement(\"p\",{key:\"1\",className:x.a.inforP},\"昵称: \",null==n?void 0:null===(a=n.userInfo)||void 0===a?void 0:a.nickName),r.a.createElement(\"p\",{key:\"2\",className:x.a.inforP},\"Token: \",null==n?void 0:n.token)]:r.a.createElement(\"p\",null,\"暂无登录记录\"))},Y=a(243);const H=Object(v.createStructuredSelector)({});var X,Z,$,ee=Object(E.b)(H,e=>({action:Object(g.b)({getMemberInformation:R,addMemberInformation:z},e)}))(U=class extends n.Component{constructor(){super(...arguments),this.state={memberName:null,roomId:null}}async UNSAFE_componentWillMount(){try{const e=this.props.item.memberId,t=await this.props.action.getMemberInformation({query:e});if(void 0!==t.result)this.setState({memberName:t.result.memberName,roomId:t.result.roomId});else{let t=(await Object(Y.b)(e)).content.roomInfo;t&&\"memberName\"in t&&\"roomId\"in t||((t={}).memberName=\"\",t.roomId=\"\");const{memberName:a,roomId:n}=t,r=a.replace(/\\s/g,\"\"),o={memberId:e,memberName:r,roomId:n};await this.props.action.addMemberInformation({data:o}),this.setState({memberName:r,roomId:n})}}catch(e){console.error(e)}}render(){return null!==this.state.memberName&&null!==this.state.roomId?\"\"!==this.state.memberName&&\"\"!==this.state.roomId?[r.a.createElement(\"b\",{key:\"0\",className:x.a.keyName},\"memberName:\"),r.a.createElement(\"span\",{key:\"1\",className:x.a.mr20},this.state.memberName),r.a.createElement(\"b\",{key:\"2\",className:x.a.keyName},\"roomId:\"),r.a.createElement(\"span\",{key:\"3\"},this.state.roomId)]:null:r.a.createElement(\"span\",{className:x.a.loadingText},\"加载中...\")}})||U;function te(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const ae=Object(v.createStructuredSelector)({loginInformation:Object(v.createSelector)(e=>e.has(\"kouDai48\")?e.get(\"kouDai48\"):null,e=>null!==e?e.get(\"loginInformation\"):null)});var ne=h.a.create()(X=Object(E.b)(ae,e=>({action:Object(g.b)({loginInformation:q,getLoginInformation:B,putLoginInformation:J,cursorMemberInformation:G,clearLoginInformation:K,clearMemberInformation:W},e)}))(($=Z=class extends n.Component{constructor(){super(...arguments),te(this,\"state\",void 0),this.state={searchString:\"\",searchResult:[]}}UNSAFE_componentWillMount(){this.props.action.getLoginInformation({query:\"loginInformation\"})}columns(){return[{title:\"memberId\",dataIndex:\"memberId\",key:\"memberId\",width:\"20%\"},{title:\"information\",key:\"information\",width:\"80%\",render:(e,t,a)=>r.a.createElement(ee,{item:t})}]}handleSubmit(e){e.preventDefault(),this.props.form.validateFields(async(e,t)=>{if(!e)try{const a=(await Object(Y.a)(t.account,t.password)).content,n={key:\"loginInformation\",value:{friends:a.friends,token:a.token,userInfo:a.userInfo}};await this.props.action.putLoginInformation({data:n}),this.props.form.resetFields(),f.a.success(\"登陆成功！\")}catch(e){f.a.error(\"登陆失败！\"),console.error(e)}})}handleInputChange(e){this.setState({searchString:e.target.value})}async handleSearchInformationClick(e){try{const e=await this.props.action.cursorMemberInformation({query:{indexName:\"memberName\",range:this.state.searchString}});this.setState({searchResult:e.result})}catch(e){console.error(e)}}async handleExitAndClearClick(e){try{await this.props.action.clearLoginInformation(),await this.props.action.clearMemberInformation(),this.props.action.loginInformation({data:null})}catch(e){console.error(e)}}render(){const{getFieldDecorator:e}=this.props.form,t=this.props.loginInformation,a=[];return this.state.searchResult.map((e,t)=>{a.push(r.a.createElement(\"div\",{key:e.memberId,className:x.a.searchGroup},r.a.createElement(\"p\",{className:x.a.searchText},\"memberId: \",e.memberId),r.a.createElement(\"p\",{className:x.a.searchText},\"memberName: \",e.memberName),r.a.createElement(\"p\",{className:x.a.searchText},\"roomId: \",e.roomId)))}),r.a.createElement(n.Fragment,null,r.a.createElement(d.a,{className:j.a.affix},r.a.createElement(\"div\",{className:k()(j.a.toolsBox,\"clearfix\")},r.a.createElement(\"div\",{className:j.a.fr},r.a.createElement(b.a,{title:\"确定退出登录并清除缓存吗？\",onConfirm:this.handleExitAndClearClick.bind(this)},r.a.createElement(p.a,{icon:\"warning\"},\"退出登录并清除缓存\")),r.a.createElement(N.a,{className:j.a.ml10,to:\"/\"},r.a.createElement(p.a,{type:\"danger\",icon:\"poweroff\"},\"返回\"))))),r.a.createElement(\"div\",{className:x.a.box},r.a.createElement(c.a,{className:x.a.body,gutter:10},r.a.createElement(m.a,{span:12},r.a.createElement(l.a,{className:x.a.mb10,title:\"口袋48登录\"},r.a.createElement(\"p\",{className:x.a.mb10},\"在使用口袋48的房间监听功能前，必须先登录，获取token，否则无法获取到房间信息。\"),r.a.createElement(\"p\",{className:x.a.mb10},\"登录一次后，token会储存在本地，不需要重复登录。\"),r.a.createElement(h.a,{onSubmit:this.handleSubmit.bind(this)},r.a.createElement(h.a.Item,{label:\"用户名\"},e(\"account\",{rules:[{message:\"必须输入用户名\",required:!0,whitespace:!0}]})(r.a.createElement(u.a,null))),r.a.createElement(h.a.Item,{label:\"密码\"},e(\"password\",{rules:[{message:\"必须输入密码\",required:!0,whitespace:!0}]})(r.a.createElement(u.a,{type:\"password\"}))),r.a.createElement(p.a,{type:\"primary\",htmlType:\"submit\"},\"登录\"))),r.a.createElement(V,{loginInformation:t?t.value:null})),r.a.createElement(m.a,{span:12},r.a.createElement(l.a,{className:x.a.mb10,title:\"ID搜索\"},r.a.createElement(\"div\",null,r.a.createElement(\"label\",{htmlFor:\"koudai48-search\"},\"在数据库中搜索小偶像的相关信息，请输入小偶像的名字：\"),r.a.createElement(u.a,{className:x.a.searchId,id:\"koudai48-search\",value:this.state.searchString,onChange:this.handleInputChange.bind(this),onPressEnter:this.handleSearchInformationClick.bind(this)}),r.a.createElement(p.a,{className:j.a.ml10,type:\"primary\",onClick:this.handleSearchInformationClick.bind(this)},\"搜索\"),a)),r.a.createElement(s.a,{columns:this.columns(),size:\"middle\",rowKey:e=>e.memberId,bordered:!0,dataSource:t?function e(t,a,n){if(0===t.length)return[];if(a===n)return[{memberId:t[a]}];const r=Math.floor((n-a)/2)+a,o=e(t,a,r),i=e(t,r+1,n);return o.concat(i)}(t.value.friends,0,t.value.friends.length-1):[],pagination:{defaultPageSize:10,showQuickJumper:!0}})))))}},te(Z,\"propTypes\",{loginInformation:y.a.object,action:y.a.objectOf(y.a.func),form:y.a.object}),X=$))||X)||X;a.d(t,\"reducer\",function(){return Q});t.default=(e=>r.a.createElement(o.a,null,r.a.createElement(i.a,{path:\"/KouDai48\",component:ne,exact:!0})))}}]);","extractedComments":[]}